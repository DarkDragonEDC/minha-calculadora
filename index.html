<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de XP Multiprofissão</title>
    <style>
        /* Estilos do Tema Escuro */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #121212; color: #e0e0e0; }
        .container { max-width: 600px; margin: auto; background: #1f1f1f; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        h1, h2, h3 { text-align: center; color: #bb86fc; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #444; background-color: #2c2c2c; color: #e0e0e0; border-radius: 4px; }
        button { width: 100%; padding: 10px; background-color: #03dac6; color: #121212; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
        button:hover { background-color: #018786; }
        #results { margin-top: 20px; border-top: 2px solid #333; padding-top: 15px; }
        
        /* Estilo para os blocos de resultados */
        .result-block { background-color: #2c2c2c; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .result-block h3 { margin-top: 0; margin-bottom: 10px; color: #bb86fc; }
        .result-block p, .result-block ul { margin: 0; padding: 0; }
        .result-block ul { list-style-type: none; }
        .result-block li { margin-bottom: 5px; }

        .xp-highlight { color: #bb86fc; font-weight: bold; }
        .time-highlight { color: #03dac6; font-weight: bold; }

        /* Estilo para a linha de crédito */
        .credits {
            text-align: center;
            margin-top: 20px;
            font-size: 0.8em;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>XP CALCULATOR</h1>
        <div class="form-group">
            <label for="profSelect">Choose a Skill:</label>
            <select id="profSelect"></select>
        </div>
        <div class="form-group">
            <label for="currentXp">Current XP:</label>
            <input type="number" id="currentXp" value="0" oninput="updateItemList()">
        </div>
        <div class="form-group">
            <label for="targetLvl">Level Goal:</label>
            <input type="number" id="targetLvl" value="1">
        </div>
        <div class="form-group">
            <label for="efficiency">Efficiency (%):</label>
            <input type="number" id="efficiency" value="0" min="0">
        </div>
        <div class="form-group">
            <label for="itemSelect">Item:</label>
            <select id="itemSelect"></select>
        </div>
        <button onclick="calculate()">Calculate</button>
        <div id="results"></div>

        <div class="credits">
            <p>Discord: darkdragonx3985</p>
        </div>
        
    </div>

     <script src="./itensimport.js"></script>

    <script>
        const profSelect = document.getElementById('profSelect');
        const itemSelect = document.getElementById('itemSelect');
        const currentXpInput = document.getElementById('currentXp');
        const resultsDiv = document.getElementById('results');

        const XP_PER_LEVEL = [
            0, 84, 192, 324, 480, 645, 820, 1005, 1200, 1407, 1735, 2082, 2449, 2838, 3249, 3684, 4144, 4631, 5146, 5691, 6460, 7281, 8160, 9101, 10109, 11191, 12353, 13603, 14949, 16400, 18455, 20675, 23076, 25675, 28492, 31549, 34870, 38482, 42415, 46702, 52583, 58662, 64933, 71390, 78026, 84833, 91802, 98923, 106186, 114398, 123502, 132734, 142077, 151515, 161029, 170602, 180216, 189852, 199491, 209115, 220417, 232945, 246859, 262341, 279598, 298871, 320434, 344603, 371744, 402278, 441971, 486789, 537487, 594941, 660170, 734360, 818896, 915396, 1025752, 1152182, 1316749, 1492835, 1681248, 1882849, 2098562, 2329375, 2576345, 2840603, 3123359, 3425908, 3749636, 4269287, 4827911, 5428432, 6073992, 6767969, 7513995, 8315973, 9178099
        ];
        
        function formatNumber(number) {
            return number.toLocaleString('pt-BR');
        }

        function getLevelFromXp(xp) {
            let currentLevel = 1;
            for (let i = 0; i < XP_PER_LEVEL.length; i++) {
                if (xp >= XP_PER_LEVEL[i]) {
                    currentLevel = i + 1;
                }
            }
            return currentLevel;
        }

        function populateProfessions() {
            for (const prof in allData) {
                const option = document.createElement('option');
                option.value = prof;
                option.textContent = prof.charAt(0).toUpperCase() + prof.slice(1);
                profSelect.appendChild(option);
            }
        }

        function updateItemList() {
            const selectedProf = profSelect.value;
            const currentXp = parseInt(currentXpInput.value) || 0;
            const currentLevel = getLevelFromXp(currentXp);

            itemSelect.innerHTML = '';
            const items = allData[selectedProf] || [];

            const filteredItems = items.filter(item => item.Level <= currentLevel);

            if (filteredItems.length > 0) {
                filteredItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.Name;
                    option.textContent = `(Lvl ${item.Level}) ${item.Name}`;
                    itemSelect.appendChild(option);
                });
            } else {
                const option = document.createElement('option');
                option.textContent = 'Nenhum item disponível para este nível';
                option.disabled = true;
                itemSelect.appendChild(option);
            }
        }

        profSelect.addEventListener('change', updateItemList);

        populateProfessions();
        updateItemList();

        function parseTime(timeString) {
            const parts = timeString.split(' ');
            if (parts.length === 2) {
                return parseInt(parts[0]);
            }
            return 0;
        }

        function formatTime(totalSeconds) {
            if (totalSeconds < 0) totalSeconds = 0;
            let parts = [];
            
            totalSeconds = Math.round(totalSeconds);

            const years = Math.floor(totalSeconds / 31536000);
            totalSeconds %= 31536000;
            const months = Math.floor(totalSeconds / 2592000);
            totalSeconds %= 2592000;
            const days = Math.floor(totalSeconds / 86400);
            totalSeconds %= 86400;
            const hours = Math.floor(totalSeconds / 3600);
            totalSeconds %= 3600;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            if (years > 0) parts.push(`${years} Year(s)`);
            if (months > 0) parts.push(`${months} Month(s)`);
            if (days > 0) parts.push(`${days} Day(s)`);
            if (hours > 0) parts.push(`${hours} hour(s)`);
            if (minutes > 0) parts.push(`${minutes} minute(s)`);
            if (seconds > 0) parts.push(`${seconds} second(s)`);
            
            return parts.length > 0 ? parts.join(', ') : '0 seconds';
        }

        function calculate() {
            const currentXp = parseInt(document.getElementById('currentXp').value);
            const targetLvl = parseInt(document.getElementById('targetLvl').value);
            const efficiency = parseFloat(document.getElementById('efficiency').value) || 0;
            const selectedProf = document.getElementById('profSelect').value;
            const selectedItemName = document.getElementById('itemSelect').value;

            if (targetLvl < 1 || targetLvl > XP_PER_LEVEL.length) {
                resultsDiv.innerHTML = `<p>O nível desejado deve ser entre 1 e ${XP_PER_LEVEL.length}.</p>`;
                return;
            }

            const selectedProfData = allData[selectedProf];
            const targetXp = XP_PER_LEVEL[targetLvl - 1];

            if (targetXp <= currentXp) {
                resultsDiv.innerHTML = `<p>Você já atingiu ou superou o nível desejado!</p>`;
                return;
            }
            
            const xpNeeded = targetXp - currentXp;
            const selectedItem = selectedProfData.find(item => item.Name === selectedItemName);

            if (!selectedItem) {
                resultsDiv.innerHTML = `<p>Item não encontrado.</p>`;
                return;
            }

            function calculateDetails(itemName, craftsNeeded, selectedProfKey, currentEfficiency) {
                const item = allData[selectedProfKey].find(i => i.Name === itemName);
                if (!item) return { rawMaterials: {}, subCrafts: {}, subItemTimes: {}, totalTime: 0, totalXp: 0 };
                
                const rawMaterials = {};
                const subCrafts = {};
                const subItemTimes = {};
                
                const baseTime = parseTime(item['Base Time']);
                const effectiveTime = baseTime * (1 - currentEfficiency / 100);
                let totalTime = effectiveTime * craftsNeeded;
                let totalXp = item['Skill Exp'] * craftsNeeded;

                for (let i = 1; i <= 4; i++) {
                    const reqName = item[`Requirement ${i}`];
                    const reqAmount = item[`Requirement ${i} Amount`];
                    
                    if (reqName && reqAmount) {
                        const isSubCraft = allData[selectedProfKey].some(subItem => subItem.Name === reqName);
                        if (isSubCraft) {
                            subCrafts[reqName] = (subCrafts[reqName] || 0) + reqAmount * craftsNeeded;
                            const subResult = calculateDetails(reqName, reqAmount * craftsNeeded, selectedProfKey, currentEfficiency);
                            subItemTimes[reqName] = (subItemTimes[reqName] || 0) + subResult.totalTime;
                            totalTime += subResult.totalTime;
                            totalXp += subResult.totalXp;
                            
                            for (const mat in subResult.rawMaterials) {
                                rawMaterials[mat] = (rawMaterials[mat] || 0) + subResult.rawMaterials[mat];
                            }
                            for (const sub in subResult.subCrafts) {
                                subCrafts[sub] = (subCrafts[sub] || 0) + subResult.subCrafts[sub];
                            }
                        } else {
                            rawMaterials[reqName] = (rawMaterials[reqName] || 0) + reqAmount * craftsNeeded;
                        }
                    }
                }
                return { rawMaterials, subCrafts, subItemTimes, totalTime, totalXp };
            }

            const { rawMaterials, subCrafts, subItemTimes, totalTime, totalXp } = calculateDetails(selectedItemName, 1, selectedProf, efficiency);
            const craftsNeeded = Math.ceil(xpNeeded / totalXp);

            const totalXpFinal = totalXp * craftsNeeded;
            const totalTimeFinal = totalTime * craftsNeeded;
            const finalRawMaterials = {};
            const finalSubCrafts = {};

            for (const mat in rawMaterials) {
                finalRawMaterials[mat] = rawMaterials[mat] * craftsNeeded;
            }
            for (const sub in subCrafts) {
                finalSubCrafts[sub] = subCrafts[sub] * craftsNeeded;
            }

            const formattedTotalTime = formatTime(totalTimeFinal);
            const sortedSubCrafts = Object.keys(finalSubCrafts).sort();
            const sortedRawMaterials = Object.keys(finalRawMaterials).sort();
            
            let resultHtml = `<div class="result-block">
                                <h3>Results</h3>
                                <p><strong>XP Required:</strong> ${formatNumber(xpNeeded)}</p>
                                <p><strong>Total XP (All crafts):</strong> <span class="xp-highlight">${formatNumber(totalXpFinal)}</span></p>
                                <p><strong>XP per ${selectedItemName}:</strong> ${formatNumber(totalXp)}</p>
                                <p><strong>Amount:</strong> ${formatNumber(craftsNeeded)} x ${selectedItemName}</p>
                              </div>`;

            resultHtml += `<div class="result-block">
                             <h3>Creation Time (with ${efficiency}% efficiency)</h3>`;
            
            const mainItemBaseTime = parseTime(selectedItem['Base Time']);
            const mainItemEffectiveTime = mainItemBaseTime * (1 - efficiency / 100);
            const mainItemTotalTime = mainItemEffectiveTime * craftsNeeded;

            if (mainItemTotalTime > 0) {
                 resultHtml += `<p><strong>Time for ${selectedItemName}:</strong> <span class="time-highlight">${formatTime(mainItemTotalTime)}</span></p>`;
            }
            
            for (const mat of sortedSubCrafts) {
                const subItem = allData[selectedProf].find(i => i.Name === mat);
                const subItemBaseTime = parseTime(subItem['Base Time']);
                const subItemEffectiveTime = subItemBaseTime * (1 - efficiency / 100);
                const subItemTotalTime = subItemEffectiveTime * finalSubCrafts[mat];

                if (subItemTotalTime > 0) {
                    resultHtml += `<p><strong>Time for ${mat}:</strong> <span class="time-highlight">${formatTime(subItemTotalTime)}</span></p>`;
                }
            }
            
            resultHtml += `<p><strong>Total Time:</strong> <span class="time-highlight">${formattedTotalTime}</span></p>
                           </div>`;
            
            if (sortedSubCrafts.length > 0) {
                resultHtml += `<div class="result-block">
                                 <h3>Sub-items to be done</h3>`;
                for (const mat of sortedSubCrafts) {
                    resultHtml += `<p><strong>${mat}:</strong> ${formatNumber(finalSubCrafts[mat])}</p>`;
                }
                resultHtml += `</div>`;
            }

            if (sortedRawMaterials.length > 0) {
                resultHtml += `<div class="result-block">
                                 <h3>Basic Materials Spent</h3>`;
                for (const mat of sortedRawMaterials) {
                    resultHtml += `<p><strong>${mat}:</strong> ${formatNumber(finalRawMaterials[mat])}</p>`;
                }
                resultHtml += `</div>`;
            }
            
            resultsDiv.innerHTML = resultHtml;
        }
    </script>
</body>

</html>